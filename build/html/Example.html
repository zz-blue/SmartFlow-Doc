<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Example &mdash; SmartFlow  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Contributors" href="Contributors.html" />
    <link rel="prev" title="Run a case" href="Run_a_case.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            SmartFlow
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="How_it_works.html">How it works</a></li>
<li class="toctree-l1"><a class="reference internal" href="Installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Run_a_case.html">Run a case</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Example</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#flow-case-configuration">Flow Case Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#training-configuration">Training Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#config-yaml">config.yaml</a></li>
<li class="toctree-l3"><a class="reference internal" href="#train-sh">train.sh</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#evaluation-configuration">Evaluation Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">config.yaml</a></li>
<li class="toctree-l3"><a class="reference internal" href="#eval-sh">eval.sh</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Contributors.html">Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="Acknowledgements.html">Acknowledgements</a></li>
<li class="toctree-l1"><a class="reference internal" href="Bibliography.html">Bibliography</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">SmartFlow</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Example</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/Example.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="example">
<h1>Example<a class="headerlink" href="#example" title="Permalink to this heading"></a></h1>
<p>After the Smartflow framework installation, you can couple the Smartflow framework with different CFD solvers for reinforcement learning (RL) applications. This example demonstrates how to train a reinforcement learning agent using the SmartFlow framework on a turbulent channel flow case at a friction Reynolds number of Ret = 5200. The case is located in the <code class="docutils literal notranslate"><span class="pre">/your/smartflow/path/SmartFlow/examples/train_retau_05200</span></code> directory. The training process is based on the MlpPolicy, and the trained agent is evaluated on the same case.</p>
<section id="flow-case-configuration">
<h2>Flow Case Configuration<a class="headerlink" href="#flow-case-configuration" title="Permalink to this heading"></a></h2>
<p>The CFD solver used in this case is <a class="reference external" href="https://github.com/CaNS-World/CaLES">CaLES</a>, configured specifically for channel flow at Ret = 5200.
For details on the CaLES case setup, please refer to the <a class="reference external" href="https://github.com/soaringxmc/SmartFlow/tree/main/examples/flow_cases">flow_cases</a> directory.</p>
</section>
<section id="training-configuration">
<h2>Training Configuration<a class="headerlink" href="#training-configuration" title="Permalink to this heading"></a></h2>
<p>The following YAML-style settings define the training environment and parameters as an example, and you may need to adjust them according to your specific requirements. In general, each case has its own configuration file, i.e., <cite>config.yaml</cite>, which contains the settings for the environment, runner, and other parameters.Taking the <cite>retau_05200</cite> case as an example, the configuration file is located in the <code class="docutils literal notranslate"><span class="pre">/your/samrtflow/path/SmartFlow/examples/train_retau_05200</span></code> directory. The configuration file is as follows:</p>
<section id="config-yaml">
<h3>config.yaml<a class="headerlink" href="#config-yaml" title="Permalink to this heading"></a></h3>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">wandb</span><span class="p">:</span>
<span class="w">  </span><span class="nt">project</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;channel&quot;</span>
<span class="w">  </span><span class="nt">run_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;train-retau-05200&quot;</span>
<span class="w">  </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;online&quot;</span>
<span class="w">  </span><span class="nt">sync_tensorboard</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">save_code</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="nt">environment</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># The following settings are used for the environment. You may need to adjust them according to your specific requirements.</span>
<span class="w">  </span><span class="c1"># The number of CFD running instances parallelly</span>
<span class="w">  </span><span class="nt">n_cfds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">  </span><span class="c1"># The number of agents per CFD environment</span>
<span class="w">  </span><span class="nt">agents_per_cfd</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">48</span>
<span class="w">  </span><span class="c1"># The number of tasks (processors) per CFD, which is the number of MPI ranks</span>
<span class="w">  </span><span class="c1"># Please note it should not exceed the number of cores your server has</span>
<span class="w">  </span><span class="nt">tasks_per_cfd</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
<span class="w">  </span><span class="c1"># Your desired state, action, and reward dimensions per your project requirements</span>
<span class="w">  </span><span class="nt">cfd_state_dim</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">  </span><span class="nt">cfd_action_dim</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">cfd_reward_dim</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">  </span><span class="c1"># The number of agent state, action, and reward dimensions per your project requirements</span>
<span class="w">  </span><span class="nt">agent_state_dim</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">  </span><span class="nt">agent_action_dim</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="c1"># The number of CFD steps between two consecutive actions</span>
<span class="w">  </span><span class="nt">cfd_steps_per_action</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">  </span><span class="c1"># The number of cells between two consecutive agents in x-, y-, and z-directions</span>
<span class="w">  </span><span class="nt">agent_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
<span class="w">  </span><span class="nt">neighbor_count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">  </span><span class="c1"># The number of polling for polling the database</span>
<span class="w">  </span><span class="nt">poll_time</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">360000000</span>
<span class="w">  </span><span class="nt">verbosity</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;debug&quot;</span>
<span class="w">  </span><span class="c1"># whether to save the trajectories</span>
<span class="w">  </span><span class="nt">save_trajectories</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">trajectory_path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;trajectories&quot;</span>
<span class="w">  </span><span class="nt">cfd_dtype</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;float64&quot;</span>
<span class="w">  </span><span class="c1"># You don&#39;t need to change the action bounds unless you have a specific requirement</span>
<span class="w">  </span><span class="nt">action_bounds</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">-1.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">1.0</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="c1"># The reward beta value, which is used to balance the global reward and local rewards in this step</span>
<span class="w">  </span><span class="nt">reward_beta</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.2</span>
<span class="w">  </span><span class="c1"># The case names for the CFD case</span>
<span class="w">  </span><span class="nt">case_names</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;retau_05200&quot;</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="c1"># You may need to adjust the CaLES executable path and case folder according to your setup below:</span>
<span class="w">  </span><span class="nt">executable_path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/scratch/maochao/code/CaLES/build/cales&quot;</span><span class="w">  </span><span class="c1"># Path to the CaLES executable</span>
<span class="w">  </span><span class="nt">case_folder</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;../flow_cases&quot;</span>

<span class="nt">runner</span><span class="p">:</span>
<span class="w">  </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;train&quot;</span>
<span class="w">  </span><span class="c1"># Whether to restart the training from the last checkpoint</span>
<span class="w">  </span><span class="c1"># If you want to restart the training, set it to true</span>
<span class="w">  </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">  </span><span class="nt">policy</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;MlpPolicy&quot;</span><span class="w"> </span><span class="c1"># Action network type</span>
<span class="w">  </span><span class="c1"># Whether to reset the number of timesteps for the training</span>
<span class="w">  </span><span class="nt">reset_num_timesteps</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">  </span><span class="nt">total_cfd_episodes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3200</span><span class="w">  </span><span class="c1"># The total number of CFD cases</span>
<span class="w">  </span><span class="c1"># The number of actions per CFD episode for each agent</span>
<span class="w">  </span><span class="nt">steps_per_episode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">120</span>
<span class="w">  </span><span class="nt">hidden_layers</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">128</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">128</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="c1"># The learning rate for the training</span>
<span class="w">  </span><span class="nt">learning_rate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5e-4</span>
<span class="w">  </span><span class="nt">log_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">summary_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">seed</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">16</span>
<span class="w">  </span><span class="nt">ckpt_num</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000000</span>
<span class="w">  </span><span class="nt">ckpt_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">batch_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>

<span class="nt">logging</span><span class="p">:</span>
<span class="w">  </span><span class="nt">save_dir</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;../runs&#39;</span>

<span class="nt">smartsim</span><span class="p">:</span>
<span class="w">  </span><span class="nt">n_dbs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">network_interface</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;lo&quot;</span>
<span class="w">  </span><span class="nt">run_command</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mpirun&quot;</span>
<span class="w">  </span><span class="nt">launcher</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;local&quot;</span>

<span class="nt">extras</span><span class="p">:</span>
<span class="w">  </span><span class="nt">n_cells</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">16</span>
<span class="w">  </span><span class="nt">tauw_min_percent</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.8</span>
<span class="w">  </span><span class="nt">tauw_max_percent</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.2</span>
<span class="w">  </span><span class="nt">hwm_min</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.075</span>
<span class="w">  </span><span class="nt">hwm_max</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.150</span>
<span class="w">  </span><span class="nt">kap_log</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.41</span>
</pre></div>
</div>
</section>
<section id="train-sh">
<h3>train.sh<a class="headerlink" href="#train-sh" title="Permalink to this heading"></a></h3>
<p>Before starting the training, remove any previous logs and caches:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rm<span class="w"> </span>-r<span class="w"> </span>__pycache__<span class="w"> </span>trajectories<span class="w"> </span>envs<span class="w"> </span>tensorboard_logs<span class="w"> </span>wandb<span class="w"> </span>models/checkpoints
</pre></div>
</div>
<p>Run the training script with the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-u<span class="w"> </span>../../src/smartflow/main.py<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>runner.mode<span class="o">=</span>train<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>runner.total_cfd_episodes<span class="o">=</span><span class="m">400</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>runner.restart<span class="o">=</span>False<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>runner.reset_num_timesteps<span class="o">=</span>True<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>&gt;<span class="w"> </span>out<span class="w"> </span><span class="m">2</span>&gt;<span class="w"> </span>err
</pre></div>
</div>
</section>
</section>
<section id="evaluation-configuration">
<h2>Evaluation Configuration<a class="headerlink" href="#evaluation-configuration" title="Permalink to this heading"></a></h2>
<p>The following settings are used for evaluating a trained policy. Similar to the training configuration, you may need to adjust them according to your specific requirements. Taking the case above as the example, the evaluation configuration file is located in the <code class="docutils literal notranslate"><span class="pre">/your/smartflow/path/SmartFlow/examples/eval_retau_05200</span></code> directory. The configuration file is as follows:</p>
<section id="id1">
<h3>config.yaml<a class="headerlink" href="#id1" title="Permalink to this heading"></a></h3>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">wandb</span><span class="p">:</span>
<span class="nt">project</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;channel&quot;</span>
<span class="nt">run_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;eval-retau-05200&quot;</span>
<span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;online&quot;</span>
<span class="nt">sync_tensorboard</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="c1"># group: null  # Optional</span>
<span class="c1"># tags: []     # Optional</span>
<span class="nt">save_code</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="nt">environment</span><span class="p">:</span>
<span class="nt">n_cfds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="nt">agents_per_cfd</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">48</span>
<span class="nt">tasks_per_cfd</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
<span class="nt">cfd_state_dim</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="nt">cfd_reward_dim</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="nt">cfd_action_dim</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="nt">agent_state_dim</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="nt">agent_action_dim</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="nt">cfd_steps_per_action</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="nt">agent_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
<span class="nt">neighbor_count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="nt">poll_time</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">360000000</span>
<span class="nt">verbosity</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;debug&quot;</span>
<span class="nt">save_trajectories</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="nt">trajectory_path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;trajectories&quot;</span>
<span class="nt">cfd_dtype</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;float64&quot;</span>
<span class="nt">action_bounds</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">-1.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">1.0</span><span class="p p-Indicator">]</span>
<span class="nt">reward_beta</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.2</span>
<span class="nt">case_names</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;retau_05200&quot;</span><span class="p p-Indicator">]</span>
<span class="c1"># You may need to adjust the CaLES executable path according to your specific dictionary.</span>
<span class="nt">executable_path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/scratch/maochao/code/CaLES/build/cales&quot;</span>
<span class="nt">case_folder</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;../flow_cases&quot;</span>

<span class="nt">runner</span><span class="p">:</span>
<span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;eval&quot;</span>
<span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="nt">policy</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;MlpPolicy&quot;</span>
<span class="nt">reset_num_timesteps</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="nt">total_cfd_episodes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="nt">steps_per_episode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">120</span>
<span class="nt">hidden_layers</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">128</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">128</span><span class="p p-Indicator">]</span>
<span class="nt">learning_rate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5e-4</span>
<span class="nt">log_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="nt">summary_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="nt">seed</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">16</span>
<span class="nt">ckpt_num</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000000</span>
<span class="nt">ckpt_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="nt">batch_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>

<span class="nt">logging</span><span class="p">:</span>
<span class="nt">save_dir</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;../runs&#39;</span>

<span class="nt">smartsim</span><span class="p">:</span>
<span class="nt">n_dbs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="nt">network_interface</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;lo&quot;</span>
<span class="nt">run_command</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mpirun&quot;</span>
<span class="nt">launcher</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;local&quot;</span>

<span class="nt">extras</span><span class="p">:</span>
<span class="nt">n_cells</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">16</span>
<span class="nt">tauw_min_percent</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.8</span>
<span class="nt">tauw_max_percent</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.2</span>
<span class="nt">hwm_min</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.075</span>
<span class="nt">hwm_max</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.150</span>
<span class="nt">kap_log</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.41</span>
</pre></div>
</div>
</section>
<section id="eval-sh">
<h3>eval.sh<a class="headerlink" href="#eval-sh" title="Permalink to this heading"></a></h3>
<p>Before starting the evaluation, remove any previous logs and caches:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rm<span class="w"> </span>-r<span class="w"> </span>__pycache__<span class="w"> </span>trajectories<span class="w"> </span>envs<span class="w"> </span>tensorboard_logs<span class="w"> </span>wandb
</pre></div>
</div>
<p>Run the evaluation script with the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-u<span class="w"> </span>../../src/smartflow/main.py<span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="c1"># You may need to adjust the path to the trained model according to your setup.</span>
<span class="w">    </span>runner.model_load_path<span class="o">=</span><span class="s2">&quot;/scratch/maochao/code/SmartFlow/experiments/train_retau_05200/models/final/yjkxqlf3&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>runner.steps_per_episode<span class="o">=</span><span class="m">3600</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>&gt;<span class="w"> </span>out<span class="w"> </span><span class="m">2</span>&gt;<span class="w"> </span>err
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Run_a_case.html" class="btn btn-neutral float-left" title="Run a case" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Contributors.html" class="btn btn-neutral float-right" title="Contributors" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, SmartFlow contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>